<template>
  <div if.bind="loading" class="loading">
    <i class="fa fa-spinner fa-spin fa-3x"></i>
    Fetching tasks...
  </div>

  <div if.bind="!loading && errored" class="error">
    <i class="fa fa-exclamation-triangle"></i>
    <p>
      Error occurred.<br>
      ${error}
    </p>
    <br>
    <button class="btn btn-primary refreshTaskList" click.delegate="loadTasks(false)"><i class="fa fa-refresh"></i></button>
  </div>

  <div class="task-runner-header">
    <h4>Tasks for "${main.selectedProject.name}"</h4>

    <button class="btn btn-primary close-button" click.delegate="close()">X</button>
  </div>

  <div class="task-list" if.bind="!loading && !errored">
    <div class="task-list-header">
      <p>${tasks.length} tasks</p>
      <button class="btn btn-primary refreshTaskList" click.delegate="loadTasks(false)"><i class="fa fa-refresh"></i></button>

      <div style="clear: both"></div>
    </div>
    <ul class="list-group">
      <li class="list-group-item ${task.id == selectedTask.id ? 'selected': ''}"
          repeat.for="task of tasks"
          click.delegate="selectedTask = task"
          dblclick.delegate="run(task)"
          title.bind="task.name">
        ${task.name} <i class="au-target glyphicon glyphicon-cog gly-spin" show.bind="task.running"></i>
      </li>
    </ul>
  </div>

  <div class="task-detail" if.bind="!loading && !errored">
    <div if.bind="selectedTask">
      <h3 class="title">${selectedTask.name}</h3>
      <button class="btn btn-primary" if.bind="selectedTask.running" click.delegate="cancel(selectedTask)">Cancel task</button>
      <button class="btn btn-primary" if.bind="!selectedTask.running" click.delegate="run(selectedTask)">Run task</button>
    </div>

    <ul class="logs" show.bind="selectedTask">
      <li style="color: white; list-style-type: none" repeat.for="log of selectedTask.logs">
        ${log.message}
      </li>
    </ul>
  </div>
</template>